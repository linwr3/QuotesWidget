# QuotesWidget - 悬浮名言桌面小工具 (WPF / .NET 8)

## 🌟 项目简介

QuotesWidget 是一个轻量级的 Windows 桌面小工具，旨在周期性地在桌面上以无边框、可置顶、自定义样式的形式展示名言警句。

**核心功能:**
1. **样式定制:** 支持文字颜色、描边颜色、粗体、斜体、字体大小调整。
2. **免安装/置顶:** 窗口支持桌面置顶，支持开机自启动。
3. **沉浸模式:** 支持“锁定”模式，隐藏所有按钮和背景，只留下透明悬浮的文字。
4. **内容轮播:** 从用户指定的文本文件读取多段内容，周期性轮换显示，并支持手动切换。

## 🛠️ 技术环境要求

| 环境 | 版本要求 | 备注 |
| :--- | :--- | :--- |
| **开发工具** | Visual Studio 2022 | 推荐使用。 |
| **框架** | .NET 8.0 (或 .NET 6.0+) | WPF 桌面应用开发。 |
| **语言** | C# | 后端逻辑实现。 |
| **操作系统** | Windows 10/11 | 仅支持 Windows 平台。 |

## ⚙️ 配置与运行

### 1. 项目配置（开发环境）

1. 使用 Visual Studio 2022 打开 `QuotesWidget.sln` 解决方案文件。
2. 确保项目针对 `net8.0-windows` 框架。
3. 直接点击 **“启动 (Start)”** 按钮运行项目。

### 2. 用户配置（运行时）

程序首次运行时，请执行以下步骤：

1. **创建内容文件:** 在您的电脑上创建一个 `quotes.txt` 文件，使用一个指定的分隔符（例如 `%`）来分隔不同的名言。
2. **设置应用:** 点击主界面右上角的 **⚙️ 设置** 按钮。
3. **配置路径:** 在设置界面中，选择您创建的 `quotes.txt` 文件。
4. **调整周期:** 设置文本轮换周期（默认为 60 秒）。
5. **保存:** 点击 **“保存并应用”**。

> **持久化存储说明:** 所有的配置（文件路径、轮换周期、**以及所有字体样式**）都将保存在 `QuotesWidget.exe` 同级目录下的 `config.json` 文件中。

### 3. 如何打包为免安装 EXE

为了方便分发，您可以将项目发布为独立的单文件 EXE：

1. 在 Visual Studio 中，右键点击项目 **`QuotesWidget`** -> **“发布 (Publish)”**。
2. 配置发布设置：
* **目标运行时:** 选择 `win-x64`。
* **部署模式:** 选择 **“独立 (Self-contained)”**。
* **文件发布选项:** 勾选 **“生成单文件 (Produce single file)”**。
3. 点击 **“发布”**。最终生成的 EXE 文件可独立运行，无需安装 .NET 运行时。

## 💡 技术挑战与实现亮点

本项目在实现过程中，解决了 Windows 桌面应用开发中的几个关键技术挑战：

### 1. 矢量文本描边与样式持久化

* **挑战:** WPF 原生的 `TextBlock` 不支持文字描边。
* **解决方案:** 实现了自定义控件 `OutlinedTextBlock`。该控件通过 C# 后台将文本 (`FormattedText`) 转换为几何图形 (`Geometry`)，然后对几何图形同时应用 `Fill` (填充色) 和 `Stroke` (描边色/粗细)，实现了高质量的矢量描边效果。
* **持久化:** 所有的字体样式属性（包括 `FontWeight`, `FontStyle` 和 Hex 颜色字符串）都被纳入到 `AppSettings` 模型中，并在运行时即时序列化到 `config.json` 文件中，确保重启应用后设置不会丢失。

### 2. 自适应布局与 UI 交互

* **挑战:** 窗口必须完全自适应多行文本的内容，并且在锁定/解锁状态之间平滑切换。
* **解决方案:**
 * **自适应:** 使用 `Window.SizeToContent="WidthAndHeight"` 结合自定义控件 `OutlinedTextBlock` 中精确计算的 `MeasureOverride`，确保窗口大小完美匹配文本内容。
 * **锁机制修正:** 通过精确控制 `MainWindow.xaml.cs` 中的 `Visibility` 属性，实现了在**锁定模式**下，只保留 **锁/置顶按钮** 可见，同时背景变为 `Transparent`（模拟玻璃浮空效果），满足了用户在锁定后仍可解锁的需求。

### 3. 系统级功能集成

* **桌面置顶:** 通过简单的 `Window.Topmost = true` 实现。
* **开机自启动:** 通过 C# 代码使用 `Microsoft.Win32.Registry` 类，操作 `HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run` 注册表键值，实现了可靠的开机启动功能。
